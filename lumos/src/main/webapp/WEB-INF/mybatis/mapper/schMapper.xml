<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sch">
	<select id="listConcertMonth" parameterType="map" resultType="com.sp.sch.Schedule">
		SELECT * FROM(
			SELECT sessionNum,c.concertName,ch.hallName,sessionDate,sessionTime,cs.concertNum		            
				,ROW_NUMBER() OVER(partition by sessionDate order by sessionDate) cnt
			FROM concertSession cs
			JOIN concert c on cs.concertNum=c.concertNum
			JOIN concertHall ch ON c.hallNum=ch.hallNum
			)
		WHERE (sessionDate &gt;= TO_DATE(#{startDay}, 'YYYYMMDD')
		             AND sessionDate &lt;= TO_DATE(#{endDay}, 'YYYYMMDD')  )
		       AND cnt=1
		ORDER BY sessionDate ASC, concertNum DESC 
	</select>
<!-- 
	<select id="listYear" parameterType="map" resultType="com.sp.sch.Schedule">
		SELECT num, subject, sday, eday, color,
		               TO_CHAR(created, 'YYYY-MM-DD') created
		  FROM schedule
		  WHERE userId = #{userId} AND
		   (
		      (
		         TO_DATE(sday, 'YYYYMMDD') = TO_DATE(#{date}, 'YYYYMMDD')
		         OR (eday IS NOT NULL AND TO_DATE(sday, 'YYYYMMDD') &gt;= TO_DATE(#{date}, 'YYYYMMDD') AND TO_DATE(eday, 'YYYYMMDD') &lt;= TO_DATE(#{date}, 'YYYYMMDD'))
		      ) OR (
		           repeat=1 AND MOD(MONTHS_BETWEEN(TO_DATE(sday, 'YYYYMMDD'), TO_DATE(#{date}, 'YYYYMMDD'))/12, repeat_cycle) = 0 			
		      )
		   )
		  ORDER BY num DESC
	</select>
 -->
</mapper>